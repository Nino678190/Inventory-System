<!DOCTYPE html>
<html lang="de">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width initial-scale=1.0">
        <base href="/"><!--- Basis Seite--->
        <link rel="stylesheet" type="text/css" href="style.css">
        <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
        <script src="script.js" type="text/javascript"></script>
        <title>
            Inventory System
        </title>
    </head>

    <body onload="getData(); getViewMode();">
        <header>
            <section>
                <button onclick="window.location.href='index.html'">
                    <img src="logo.png" alt="Logo" class="logo">
                </button>
            </section>
            <nav>
                <nav>
                    <select name="searchType" id="searchType">
                        <option value="full">Full Text</option>
                        <option value="id">ID</option>
                        <option value="tag">Tag</option>
                        <option value="anzahl">Anzahl</option>
                    </select>
                    <input type="search" name="search" id="search" placeholder="Suche...">
                    <button onclick="searchItems()">
                        <img src="images/search-icon.png" alt="Suche" class="headIcon">
                    </button>
                </nav>
                <button onclick="document.querySelector('dialog').showModal()">
                    <img src="images/plus-icon.png" alt="Hinzu" class="headIcon">
                </button>
                <button onclick="window.location.href='settings.html'">
                    <img src="images/setting-icon.png" alt="Einstellungen" class="headIcon">
                </button>
            </nav>
        </header>
        <noscript>Bitte aktiviere JS</noscript>
        <main>
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Beschreibung</th>
                        <th>Anzahl</th>
                        <th>Tags</th>
                        <th>Ort</th>
                        <th class="none">
                            <button onclick="getData()">
                                <img src="images/undo-arrow-icon.png" alt="Reset" class="menu" title="Daten zurÃ¼cksetzen">
                            </button>
                        </th>
                    </tr>
                </thead>
                <tbody id="data-table">
                </tbody>
            </table>
        </main>
        <dialog id="add-dialog">
            <section class="dialogHeader">
                <select name="addType" id="addType" onchange="toggleForms()">
                    <option value="add-item">Item hinzufÃ¼gen</option>
                    <option value="add-tag">Tag hinzufÃ¼gen</option>
                </select>
                <button onclick="document.querySelectorAll('form').forEach(form => {form.reset()})">
                    <img src="images/undo-arrow-icon.png" alt="Reset" class="formReset menu" title="Formular zurÃ¼cksetzen">
                </button>
            </section>
            <form id="add-item-form">
                <label for="name">Name:<input type="text" id="name" name="name" required></label><br>
                <label for="description">Beschreibung:<input type="text" id="description" name="description" required></label>
                <br>
                <label for="quantity">Anzahl:<input type="number" id="quantity" name="quantity" required></label>
                <br>
                <label for="tags">Tags:<input type="text" id="tags" name="tags" oninput="suggestTag('tags')"></label><br>
                <label for="ort">Ort:<input type="text" id="ort" name="ort"></label><br>
                <section>
                    <button type="submit" class="normalButton">HinzufÃ¼gen</button>
                    <button type="button" class="normalButton red" onclick="document.querySelector('dialog').close()">Abbrechen</button>
                </section>
            </form>

            <form id="tag-add" style="display: none;">
                <label for="tag-name">Tag Name:<input type="text" id="tag-name" name="tag-name" required></label>
                <label for="tag-description">Tag Beschreibung:<input type="text" id="tag-description" name="tag-description" required></label>
                <label for="tag-color">Tag Farbe:<input type="color" id="tag-color" name="tag-color" required></label>
                
                <label for="tag-icon">Tag Emoji:
                    <select name="tag-icon" id="tag-icon">
                        <option value="ğŸ“¦">ğŸ“¦ Paket</option>
                        <option value="ğŸ“…">ğŸ“… Kalender</option>
                        <option value="ğŸ“ˆ">ğŸ“ˆ Steigendes Diagramm</option>
                        <option value="ğŸ“‰">ğŸ“‰ Fallendes Diagramm</option>
                        <option value="ğŸ“Š">ğŸ“Š Balkendiagramm</option>
                        <option value="ğŸ“">ğŸ“ Standort-Pin</option>
                        <option value="ğŸ“">ğŸ“ Ordner</option>
                        <option value="ğŸ—‚ï¸">ğŸ—‚ï¸ Ablage</option>
                        <option value="ğŸ·ï¸">ğŸ·ï¸ Etikett</option>
                        <option value="ğŸ’”">ğŸ’” Gebrochenes Herz</option>
                        <option value="ğŸ’•">ğŸ’• Zwei Herzen</option>
                        <option value="ğŸ’–">ğŸ’– Glitzerndes Herz</option>
                        <option value="ğŸ’¼">ğŸ’¼ Aktentasche</option>
                        <option value="ğŸ˜‚">ğŸ˜‚ LachtrÃ¤nen</option>
                        <option value="ğŸ˜…">ğŸ˜… Erleichtertes LÃ¤cheln</option>
                        <option value="ğŸ˜†">ğŸ˜† Grinsendes Lachen</option>
                        <option value="ğŸ˜‹">ğŸ˜‹ Leckeres Gesicht</option>
                        <option value="ğŸ˜">ğŸ˜ Cooles Gesicht</option>
                        <option value="ğŸ˜œ">ğŸ˜œ Zunge raus</option>
                        <option value="ğŸ˜¡">ğŸ˜¡ WÃ¼tendes Gesicht</option>
                        <option value="ğŸ˜¢">ğŸ˜¢ Trauriges Gesicht</option>
                        <option value="ğŸ˜">ğŸ˜ Zahniges Grinsen</option>
                        <option value="ğŸ˜">ğŸ˜ Verliebtes Gesicht</option>
                        <option value="ğŸ¥°">ğŸ¥° LÃ¤chelnd mit Herzen</option>
                        <option value="ğŸ¥º">ğŸ¥º Bittendes Gesicht</option>
                        <option value="ğŸ˜­">ğŸ˜­ Weinendes Gesicht</option>
                        <option value="ğŸ¤”">ğŸ¤” Nachdenklich</option>
                        <option value="ğŸ¤—">ğŸ¤— Umarmung</option>
                        <option value="ğŸ¤©">ğŸ¤© Beeindruckt</option>
                        <option value="ğŸ¤«">ğŸ¤« Psst!</option>
                        <option value="ğŸ™">ğŸ™ Betend</option>
                        <option value="â¤ï¸">â¤ï¸ Rotes Herz</option>
                        <option value="ğŸ‰">ğŸ‰ Party</option>
                        <option value="ğŸ”§">ğŸ”§ SchraubenschlÃ¼ssel</option>
                        <option value="ğŸ› ï¸">ğŸ› ï¸ Werkzeug</option>
                        <option value="ğŸ‘">ğŸ‘ Daumen hoch</option>
                        <option value="ğŸ™„">ğŸ™„ Augenrollen</option>
                        <option value="ğŸ¤£">ğŸ¤£ Lachanfall</option>
                    </select>
                </label>

                <section>
                    <button type="submit" class="normalButton">Tag hinzufÃ¼gen</button>
                    <button type="button" class="normalButton red" onclick="document.querySelector('dialog').close()">Abbrechen</button>
                </section>
            </form>
        </dialog>
    </body>
    <script>
        document.getElementById('search').addEventListener('keydown', function (event) {
            if (event.key === 'Enter') {
                searchItems();
            }
        });

        document.getElementById('tag-add').addEventListener('submit', function (event) {
            event.preventDefault();
            const tagName = document.getElementById('tag-name').value;
            const tagDescription = document.getElementById('tag-description').value;
            const tagColor = document.getElementById('tag-color').value;
            const tagIcon = document.getElementById('tag-icon').value;
            const emoji = emojiToHtmlUnicode(tagIcon);
            fetch('/api/addTag', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ name: tagName, description: tagDescription, color: tagColor, emoji: tagIcon })
            }).then(response => {
                if (!response.ok) {
                    throw new Error('Netzwerkantwort war nicht ok');
                }
                return response.json();
            }).then(data => {
                console.log(data);
                document.getElementById('tag-add').reset();
                document.querySelector('dialog').close();
                getData(); // Aktualisiere die Tabelle
                getTags(); // Aktualisiere die Tags 
            }).catch(error => {
                console.error('Es gab ein Problem mit der Fetch-Operation:', error);
            });
        });

        document.getElementById('add-item-form').addEventListener('submit', function (event) {
            event.preventDefault();
            const name = document.getElementById('name').value;
            const description = document.getElementById('description').value;
            const quantity = document.getElementById('quantity').value;
            const tags = document.getElementById('tags').value;
            const ort = document.getElementById('ort').value;
            const length = tags.length;
            if (length > 0 && tags[length - 1] === ',') {
                tags = tags.slice(0, -1); // Remove trailing comma
            }
            fetch('/api/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: { "name": name, "description": description, "quantity": quantity, "tags":tags, "ort":ort }
            }).then(response => {
                if (!response.ok) {
                    throw new Error('Netzwerkantwort war nicht ok');
                }
                document.getElementById('add-item-form').reset();
                document.querySelector('dialog').close();
                getData(); // Aktualisiere die Tabelle
            }).catch(error => {
                console.error('Es gab ein Problem mit der Fetch-Operation:', error);
            });
        });

    </script>
</html>